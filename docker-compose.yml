version: '3'
services:
    crystal-api:
        build:
            context: crystal-api
            target: base
        stdin_open: true
        tty: true
        environment:
            BIND: 0.0.0.0
            PORT: 8080
            DEBUG: '${DEBUG:-true}'
        ports:
            - '8080:8080'
        volumes:
            - ./crystal-api:/api

    datadog-agent:
      image: datadog/agent
      env_file:
        - ./.env
      ports:
        - "8126:8126"
      volumes:
        - /var/run/docker.sock:/var/run/docker.sock
        - /proc/:/host/proc/:ro
        - /sys/fs/cgroup:/host/sys/fs/cgroup:ro
        - /var/lib/docker/containers:/var/lib/docker/containers:ro

    datadog-app:
        build: datadog-app
        stdin_open: true
        tty: true
        environment:
            REACT_APP_API_URL: http://localhost:8080
        ports:
            - '3010:3000'
        volumes:
            - ./datadog-app:/datadog-app

    flask-proxy:
      build: flask-proxy
      env_file:
        - ./.env
      environment:
        FLASK_APP: app.py
      ports:
        - "5000:5000"
      stdin_open: true
      tty: true
      volumes:
        - ./flask-proxy:/app

    setup:
        stdin_open: true
        tty: true
        build: setup
        env_file: ./.env
        volumes:
            - ./setup:/setup

